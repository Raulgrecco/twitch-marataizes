<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Overlay GN - Tempo + Ticker</title>
<style>
  /* Fundo transparente para overlay no OBS */
  html, body {
    margin: 0; height: 100%; background: transparent;
    font-family: "Segoe UI", Arial, system-ui, sans-serif;
  }
  * { box-sizing: border-box }

  :root{
    /* Cores GN-like (pode mudar via URL) */
    --gn-red: 196, 23, 12;      /* #C4170C */
    --bar-bg: 0, 0, 0;          /* preto */
    --bar-op: .90;              /* opacidade da barra */
    --accent: 247,183,51;       /* amarelo detalhe */
    --h: 64px;                  /* altura do ticker */
    --speed: 22s;               /* velocidade do marquee */
    --wx: 480px;                /* largura widget tempo */
    --wy: 220px;                /* altura widget tempo */
  }

  /* Tempo (canto superior direito) */
  .weather {
    position: fixed; right: 14px; top: 14px;
    width: var(--wx); height: var(--wy);
    background: rgba(0,0,0,.35);
    border: 1px solid rgba(255,255,255,.12);
    border-radius: 10px;
    backdrop-filter: blur(2px);
    overflow: hidden;
    pointer-events: none; /* não intercepta clique no OBS */
  }
  .weather iframe {
    width: 100%; height: 100%; border: 0; background: transparent;
  }

  /* Barra inferior GN-like */
  .ticker-wrap {
    position: fixed; left: 0; right: 0; bottom: 0;
    height: var(--h); display: flex; align-items: stretch;
    background: rgba(var(--bar-bg), var(--bar-op));
    border-top: 3px solid rgb(var(--accent));
  }
  .tag {
    display: flex; align-items: center;
    padding: 0 16px;
    background: rgb(var(--gn-red));
    color: #fff; font-weight: 900; letter-spacing: .3px;
    font-size: 20px;
  }
  .track {
    flex: 1; overflow: hidden; position: relative; display: flex; align-items: center;
  }
  .marq {
    display: inline-block; white-space: nowrap; color: #fff; font-weight: 700;
    font-size: 20px; padding-left: 24px;
    animation: scroll var(--speed) linear infinite;
    will-change: transform;
  }
  .bullet { opacity: .55; padding: 0 18px }
  @keyframes scroll {
    from { transform: translateX(100%) }
    to   { transform: translateX(-100%) }
  }

  /* Segurança para telas menores */
  @media (max-width: 900px) {
    :root { --wx: 380px; --wy: 200px; --h: 56px }
    .tag, .marq { font-size: 18px }
  }
</style>
</head>
<body>

<!-- CLIMA (meteoblue) -->
<div class="weather" id="wxBox">
  <iframe id="wx"
    src="https://www.meteoblue.com/en/weather/widget/daily/marataizes_brazil_3457819?geoloc=fixed&days=5&tempunit=CELSIUS&windunit=KILOMETER_PER_HOUR&precipunit=MILLIMETER&coloured=coloured&pictoicon=1&maxtemperature=1&mintemperature=1&windspeed=1&windgust=0&winddirection=1&uv=0&humidity=0&precipitation=1&precipitationprobability=1&spot=1&pressure=0&layout=light"
    scrolling="NO" frameborder="0" allowtransparency="true"
    sandbox="allow-same-origin allow-scripts allow-popups allow-popups-to-escape-sandbox"></iframe>
</div>

<!-- TICKER -->
<div class="ticker-wrap">
  <div class="tag" id="tag">AO VIVO</div>
  <div class="track">
    <div class="marq" id="mq">Carregando…</div>
  </div>
</div>

<script>
  /* ========= Parâmetros por URL =========
    &h=64                 -> altura do ticker (px)
    &speed=18s            -> velocidade do texto (tempo menor = mais rápido)
    &barbg=0,0,0&barop=.9 -> cor/alpha de fundo
    &accent=247,183,51    -> cor da linha superior (RGB)
    &tag=NOTÍCIAS         -> texto da tag
    &tagcolor=196,23,12   -> cor da tag (RGB)
    &wx=480&wy=220        -> largura/altura do widget do tempo (px)
    &wxurl=URLENCODED     -> URL completa alternativa do widget meteoblue
    &hidewx=1             -> oculta o widget do tempo
  ===================================== */
  const qs = new URLSearchParams(location.search);
  const css = (k,v) => document.documentElement.style.setProperty(k,v);

  if (qs.get('h')) css('--h', qs.get('h')+'px');
  if (qs.get('speed')) css('--speed', qs.get('speed'));
  if (qs.get('accent')) css('--accent', qs.get('accent'));
  if (qs.get('barbg')) css('--bar-bg', qs.get('barbg'));
  if (qs.get('barop')) css('--bar-op', qs.get('barop'));
  if (qs.get('tagcolor')) css('--gn-red', qs.get('tagcolor'));
  if (qs.get('wx')) css('--wx', qs.get('wx')+'px');
  if (qs.get('wy')) css('--wy', qs.get('wy')+'px');

  const tagEl = document.getElementById('tag');
  if (qs.get('tag')) tagEl.textContent = qs.get('tag');

  const wxBox = document.getElementById('wxBox');
  const wxIframe = document.getElementById('wx');
  if (qs.get('hidewx') === '1') wxBox.style.display = 'none';
  if (qs.get('wxurl')) wxIframe.src = decodeURIComponent(qs.get('wxurl'));

  // ----------- ticker -----------
  const mq = document.getElementById('mq');
  const SEP = ' <span class="bullet">•</span> ';

  async function loadTicker(){
    try{
      const r = await fetch('ticker.txt?_=' + Date.now(), { cache:'no-store' });
      const t = await r.text();
      const itens = t.split(/\r?\n/).map(s => s.trim()).filter(Boolean);
      mq.innerHTML = itens.length ? itens.join(SEP) + SEP : ' ';
    }catch(e){
      mq.textContent = '⚠️ Não foi possível carregar as notícias.';
    }
  }
  loadTicker();
  setInterval(loadTicker, 20000); // atualiza a cada 20s
</script>
</body>
</html>
